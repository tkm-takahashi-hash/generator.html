<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>パスワードジェネレーター</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      max-width: 480px;
      margin: 40px auto;
      background: #ffffff;
      border-radius: 8px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    h1 {
      margin-top: 0;
      font-size: 1.4rem;
      text-align: center;
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
    }

    input[type="number"] {
      width: 100%;
      padding: 6px 8px;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      font-size: 0.9rem;
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 0;
      cursor: pointer;
    }

    .output-group {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .output-group input {
      flex: 1;
      padding: 6px 8px;
      font-size: 0.95rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    button {
      padding: 8px 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
    }

    #generateBtn {
      width: 100%;
      margin-top: 8px;
      background: #1976d2;
      color: #ffffff;
    }

    #copyBtn {
      white-space: nowrap;
      background: #e0e0e0;
    }

    small {
      font-size: 0.75rem;
      color: #666;
    }

    .message {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #1976d2;
      min-height: 1em;
    }

    @media (max-width: 480px) {
      .container {
        margin: 16px;
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>パスワードジェネレーター</h1>

    <div class="form-group">
      <label for="length">文字数</label>
      <input id="length" type="number" min="4" max="64" value="16" />
      <small>4〜64文字の範囲で指定してください。</small>
    </div>

    <div class="form-group">
      <label>使用する文字の種類</label>
      <div class="checkbox-group">
        <label>
          <input type="checkbox" id="useLower" checked />
          小文字 (a-z)
        </label>
        <label>
          <input type="checkbox" id="useUpper" checked />
          大文字 (A-Z)
        </label>
        <label>
          <input type="checkbox" id="useNumber" checked />
          数字 (0-9)
        </label>
        <label>
          <input type="checkbox" id="useSymbol" />
          記号 (!@#など)
        </label>
      </div>
    </div>

    <button id="generateBtn">パスワードを生成</button>

    <div class="form-group">
      <label for="passwordOutput">生成されたパスワード</label>
      <div class="output-group">
        <input id="passwordOutput" type="text" readonly />
        <button id="copyBtn" type="button">コピー</button>
      </div>
      <div class="message" id="message"></div>
    </div>

  </div>

  <script>
    const LOWER = "abcdefghijklmnopqrstuvwxyz";
    const UPPER = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const NUMBERS = "0123456789";
    const SYMBOLS = "!@#$%^&*()-_=+[]{};:,.?";

    const lengthInput = document.getElementById("length");
    const useLower = document.getElementById("useLower");
    const useUpper = document.getElementById("useUpper");
    const useNumber = document.getElementById("useNumber");
    const useSymbol = document.getElementById("useSymbol");
    const generateBtn = document.getElementById("generateBtn");
    const passwordOutput = document.getElementById("passwordOutput");
    const copyBtn = document.getElementById("copyBtn");
    const message = document.getElementById("message");

    function getRandomChar(str) {
      const index = Math.floor(Math.random() * str.length);
      return str[index];
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function generatePassword() {
      message.textContent = "";

      const length = parseInt(lengthInput.value, 10);
      if (isNaN(length) || length < 4 || length > 64) {
        message.textContent = "文字数は 4〜64 の範囲で入力してください。";
        return;
      }

      const charSets = [];
      if (useLower.checked) charSets.push(LOWER);
      if (useUpper.checked) charSets.push(UPPER);
      if (useNumber.checked) charSets.push(NUMBERS);
      if (useSymbol.checked) charSets.push(SYMBOLS);

      if (charSets.length === 0) {
        message.textContent = "少なくとも1種類の文字を選択してください。";
        return;
      }

      // すべての選択された文字種を結合
      const allChars = charSets.join("");

      const passwordChars = [];

      // 各選択された文字種から最低1文字ずつ確実に使用する
      charSets.forEach(set => {
        passwordChars.push(getRandomChar(set));
      });

      // 残りの文字をランダムに埋める
      for (let i = passwordChars.length; i < length; i++) {
        passwordChars.push(getRandomChar(allChars));
      }

      // パスワード文字列をランダムに並べ替え
      shuffleArray(passwordChars);

      const password = passwordChars.join("");
      passwordOutput.value = password;
      message.textContent = "新しいパスワードを生成しました。";
    }

    function copyPassword() {
      if (!passwordOutput.value) {
        message.textContent = "まずパスワードを生成してください。";
        return;
      }
      passwordOutput.select();
      passwordOutput.setSelectionRange(0, 99999); // モバイル対応
      const ok = document.execCommand("copy");
      if (ok) {
        message.textContent = "クリップボードにコピーしました。";
      } else {
        message.textContent = "コピーに失敗しました。手動でコピーしてください。";
      }
      window.getSelection().removeAllRanges();
    }

    generateBtn.addEventListener("click", generatePassword);
    copyBtn.addEventListener("click", copyPassword);
  </script>
</body>
</html>
